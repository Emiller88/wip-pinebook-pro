From d14eb7e281498c6e076e32c36a179aac405957fd Mon Sep 17 00:00:00 2001
From: Jimmy Brisson <theotherjimmy@gmail.com>
Date: Thu, 30 Jan 2020 11:08:53 -0600
Subject: [PATCH 3/5] Configure suspend for rk3399

---
 .../boot/dts/rockchip/rk3399-pinebook-pro.dts | 28 +++++++++++++++++++
 arch/arm64/configs/pinebook_pro_defconfig     |  3 ++
 2 files changed, 31 insertions(+)

diff --git a/arch/arm64/boot/dts/rockchip/rk3399-pinebook-pro.dts b/arch/arm64/boot/dts/rockchip/rk3399-pinebook-pro.dts
index 39ceb4251d56..7518322193b8 100644
--- a/arch/arm64/boot/dts/rockchip/rk3399-pinebook-pro.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3399-pinebook-pro.dts
@@ -8,6 +8,7 @@
 #include <dt-bindings/input/linux-event-codes.h>
 #include <dt-bindings/pwm/pwm.h>
 #include <dt-bindings/usb/pd.h>
+#include <dt-bindings/suspend/rockchip-rk3399.h>
 //#include <dt-bindings/leds/common.h>
 #include "rk3399.dtsi"
 #include "rk3399-opp.dtsi"
@@ -16,6 +17,32 @@ / {
 	model = "Pine64 Pinebook Pro";
 	compatible = "pine64,pinebook-pro", "rockchip,rk3399";
 
+  rockchip_suspend: rockchip_suspend {
+    compatible = "rockchip,pm-rk3399";
+    status = "okay";
+    rockchip,sleep-mode-config = <
+      (0
+      | RKPM_SLP_ARMPD
+      | RKPM_SLP_PERILPPD
+      | RKPM_SLP_DDR_RET
+      | RKPM_SLP_PLLPD
+      | RKPM_SLP_OSC_DIS
+      | RKPM_SLP_CENTER_PD
+      | RKPM_SLP_AP_PWROFF
+      )
+    >;
+    rockchip,wakeup-config = <
+      (0 |
+      RKPM_GPIO_WKUP_EN |
+      RKPM_PWM_WKUP_EN)
+    >;
+    rockchip,pwm-regulator-config = <
+      (0 |
+      PWM2_REGULATOR_EN
+      )
+    >;
+  };
+
 	edp_panel: edp-panel {
 		compatible = "boe,nv140fhmn49", "simple-panel";
 		backlight = <&backlight>;
@@ -1211,3 +1238,4 @@ vendor@7c0000 {
 		};
 	};
 };
+
diff --git a/arch/arm64/configs/pinebook_pro_defconfig b/arch/arm64/configs/pinebook_pro_defconfig
index 884f07fcc590..fa34cf79dc60 100644
--- a/arch/arm64/configs/pinebook_pro_defconfig
+++ b/arch/arm64/configs/pinebook_pro_defconfig
@@ -1,4 +1,7 @@
 CONFIG_LOCALVERSION="-MANJARO-ARM"
+CONFIG_ROCKCHIP_SUSPENND_MODE=y
+CONFIG_ROCKCHIP_SIP=y
+CONFIG_ARM_PSCI_FW=y
 # CONFIG_LOCALVERSION_AUTO is not set
 CONFIG_SYSVIPC=y
 CONFIG_POSIX_MQUEUE=y
-- 
2.24.0

